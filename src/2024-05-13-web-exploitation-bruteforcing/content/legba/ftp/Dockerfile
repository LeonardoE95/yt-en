FROM alpine
     
# https://github.com/fikipollo/vsftpd-docker

RUN apk update && apk upgrade &&  apk --update --no-cache add vsftpd

# RUN useradd -rm -d /home/ftpuser -s /bin/bash -g root -G sudo ftpuser
RUN addgroup -g 1000 -S ftpuser
RUN adduser -u 1000 -D -G ftpuser -h /home/ftpuser -s /bin/false  ftpuser

RUN echo "local_enable=YES" >> /etc/vsftpd/vsftpd.conf \
  && echo "chroot_local_user=YES" >> /etc/vsftpd/vsftpd.conf \
  && echo "allow_writeable_chroot=YES" >> /etc/vsftpd/vsftpd.conf \
  && echo "background=NO" >> /etc/vsftpd/vsftpd.conf \
  && echo "dirmessage_enable=YES" >> /etc/vsftpd/vsftpd.conf \
  && echo "write_enable=YES" >> /etc/vsftpd/vsftpd.conf \
  && echo "passwd_chroot_enable=yes" >> /etc/vsftpd/vsftpd.conf \
  && echo "listen_ipv6=NO" >> /etc/vsftpd/vsftpd.conf \
  && echo "seccomp_sandbox=NO" >> /etc/vsftpd/vsftpd.conf \
  && echo "local_umask=022" >> /etc/vsftpd/vsftpd.conf \
  && sed -i "s/anonymous_enable=YES/anonymous_enable=NO/" /etc/vsftpd/vsftpd.conf

ARG password

RUN echo "ftpuser:$password" | chpasswd

CMD ["/usr/sbin/vsftpd", "/etc/vsftpd/vsftpd.conf"]